{"version":3,"file":"BldnPrivRequest.js","sourceRoot":"","sources":["../../src/BldnPrivRequest.ts"],"names":[],"mappings":"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","sourcesContent":["import { html, css, LitElement, PropertyValueMap } from 'lit';\nimport { property, state } from 'lit/decorators.js';\nimport { when } from 'lit/directives/when.js';\nimport { map } from 'lit/directives/map.js';\nimport { choose } from 'lit/directives/choose.js';\nimport { v4 as uuidv4 } from 'uuid';\n\nimport './DemandBuilder.js';\nimport './RequestProgressIndicator.js';\nimport './FrequentRequestsMenu.js';\nimport './ResponseView.js';\nimport { ACTION } from './models/priv-terms.js';\nimport { PrivacyRequest } from './models/privacy-request.js';\nimport { sendPrivacyRequest } from './utils/PrivacyRequestApi.js';\nimport { PrivacyResponse } from './models/privacy-response.js';\nimport { RequestState, DemandState } from './utils/states.js';\nimport { Demand } from './models/demand.js';\nimport { getDefaultActions } from './utils/utils.js';\n\n/**\n * Top level component encapsulating a single PrivacyRequest. Contains one or\n * more DemandBuilder elements, each for a single demand action type.\n */\nexport class BldnPrivRequest extends LitElement {\n  // JSON string of actions to display\n  @property({ type: String, attribute: 'actions' }) actions = '';\n\n  // Array of actions, given by actions attribute if a valid list was passed, otherwise includes the 9 defaults\n  @state() _includedActions: ACTION[] = getDefaultActions();\n\n  // State of the whole privacy request\n  @state() _requestState: RequestState = RequestState.BUILD;\n\n  // Privacy request object, empty until some demands are added\n  @state() _privacyRequest: PrivacyRequest = { demands: [] };\n\n  // Map of ids to their specific demands\n  @state() _demands: Map<string, Demand> = new Map<string, Demand>();\n\n  // Map of ids to demand builder UI components\n  @state() _demandBuilders: Map<string, boolean> = new Map<string, boolean>([\n    [uuidv4(), false],\n  ]);\n\n  // Boolean indicating if review/complete buttons should be displayed\n  @state() _showButtons: boolean = false;\n\n  // Bolean indicating if review/complete buttons should be clickable\n  @state() _buttonsClickable: boolean = false;\n\n  // Response to our request\n  @state() _privacyResponse: PrivacyResponse = {\n    responseId: '',\n    inResponseTo: '',\n    date: '',\n    system: '',\n    status: '',\n  };\n\n  constructor() {\n    super();\n\n    // Demand update listeners\n    this.addEventListener('demand-set', e => {\n      const { demandId, demand } = (e as CustomEvent).detail;\n      this._demands.set(demandId, demand);\n    });\n    this.addEventListener('demand-delete', e => {\n      const { id } = (e as CustomEvent).detail;\n      this._demands.delete(id);\n    });\n    this.addEventListener('demand-set-multiple', e => {\n      ((e as CustomEvent).detail.demands as Map<string, Demand>).forEach(\n        (demand, id) => this._demands.set(id, demand)\n      );\n    });\n\n    // Event indicating a demand builder has a valid action form\n    this.addEventListener('demand-validated', e => {\n      const { demandBuilderId } = (e as CustomEvent).detail;\n      this._demandBuilders.set(demandBuilderId, true);\n      // Check if review/submit buttons should be enabled\n      this._buttonsClickable = Array.from(this._demandBuilders.values()).every(\n        b => b === true\n      );\n    });\n\n    // Event indicating a demand builder has an invalid action form\n    this.addEventListener('demand-invalidated', e => {\n      const { demandBuilderId } = (e as CustomEvent).detail;\n      this._demandBuilders.set(demandBuilderId, false);\n      // Check if review/submit buttons should be disabled\n      this._buttonsClickable = Array.from(this._demandBuilders.values()).every(\n        b => b === true\n      );\n    });\n\n    // Unhide review and submit buttons when demand builder has passed the action menu\n    this.addEventListener('menu-done', () => {\n      this._showButtons = true;\n    });\n  }\n\n  static styles = css`\n    :host {\n      display: grid;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen,\n        Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\n      font-size: 16;\n      max-width: 1350px;\n      background-color: white;\n      /* max-height: 750px; */\n    }\n\n    :host button {\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen,\n        Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\n    }\n\n    #priv-req-ctr {\n      display: grid;\n      border: 2px solid #000;\n      border-radius: 20px;\n      padding: 30px;\n      margin: 0px 0px 30px 0px;\n    }\n\n    #new-dmd-ctr {\n      display: flex;\n      column-gap: 10px;\n      margin: 20px 0px 0px 0px;\n      padding: 20px;\n      border: 2px solid #000;\n      border-radius: 20px;\n      align-items: center;\n      justify-content: center;\n    }\n\n    #request-progress-indicator {\n      background-color: red;\n    }\n\n    #frequent-requests {\n      background-color: green;\n    }\n\n    #restart-btn {\n      background: #fafafa;\n      border: none;\n      width: fit-content;\n      height: fit-content;\n      text-decoration: underline;\n      margin: 20px 0px;\n    }\n\n    #req-sent-hdr {\n      padding: 40px 0px;\n    }\n\n    .req-hdr {\n      font-weight: bold;\n      font-size: 24px;\n      text-align: center;\n      padding-bottom: 20px;\n    }\n\n    .new-dmd-btn {\n      width: 20px;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      text-align: center;\n    }\n\n    .nav-btn {\n      height: 50px;\n      background-color: #18a0fb;\n      border-width: 0px;\n      border-radius: 6px;\n      font-size: 18px;\n      color: #ffffff;\n      width: fit-content;\n      margin: 20px 0px -55px 0px;\n      padding: 0px 25px;\n    }\n\n    button:disabled {\n      /* background-color: #d9d9d9; */\n      background-color: #a9d1ff;\n    }\n\n    .ctr-btn {\n      justify-self: center;\n    }\n\n    .right-btn {\n      justify-self: flex-end;\n      margin: 20px 60px -55px 0px;\n    }\n\n    .demand-builder-next-btn {\n      grid-column: 2/3;\n      padding-bottom: -50px;\n      margin-bottom: -50px;\n    }\n\n    .ctr-txt {\n      text-align: center;\n    }\n  `;\n\n  handleSubmitClick() {\n    // Form privacy request\n    this._privacyRequest.demands = Array.from(this._demands.values());\n    sendPrivacyRequest(this._privacyRequest).then(response => {\n      this._privacyResponse = response;\n    });\n    this._requestState = RequestState.SENT;\n  }\n\n  /**\n   * Switch request to the review state, causing all demand builders to switch\n   */\n  handleReviewClick() {\n    this._requestState = RequestState.REVIEW;\n  }\n\n  /**\n   * Reset most states\n   */\n  handleRestartClick() {\n    this._requestState = RequestState.BUILD;\n    this._privacyRequest = {\n      demands: [{ action: ACTION.TRANSPARENCY }],\n    };\n    this._demands = new Map<string, Demand>();\n    this._demandBuilders = new Map<string, boolean>([[uuidv4(), false]]);\n    this._showButtons = false;\n    this._buttonsClickable = false;\n    this._privacyResponse = {\n      responseId: '',\n      inResponseTo: '',\n      date: '',\n      system: '',\n      status: '',\n    };\n  }\n\n  // Hook into willUpdate lifecycle method to set the included actions state if a valid list of actions is passed as an attribute\n  protected willUpdate(\n    _changedProperties: PropertyValueMap<any> | Map<PropertyKey, unknown>\n  ): void {\n    if (_changedProperties.has('actions') && this.actions) {\n      try {\n        const actionsList = (\n          Array.from(JSON.parse(this.actions)) as string[]\n        ).map(a => a.toLocaleLowerCase());\n        const validActionsList = getDefaultActions().filter(a =>\n          actionsList.includes(a.toLocaleLowerCase())\n        );\n        // If a valid list of actions has been passed, use it\n        if (validActionsList.length > 0) {\n          this._includedActions = validActionsList;\n        }\n      } catch {\n        this._includedActions = getDefaultActions();\n      }\n    }\n  }\n\n  render() {\n    return html`\n      <div id=\"priv-req-ctr\">\n        <div class=\"req-hdr\">My Privacy Request</div>\n        <request-progress-indicator></request-progress-indicator>\n\n        <!-- BUILD AND REVIEW STATE -->\n        ${when(\n          this._requestState === RequestState.BUILD ||\n            this._requestState === RequestState.REVIEW,\n          () => html`\n            ${map(\n              this._demandBuilders.entries(),\n              ([id]) => html`\n                <demand-builder\n                  id=${id}\n                  .includedActions=${this._includedActions}\n                  demand-state=${this._requestState === RequestState.REVIEW\n                    ? DemandState.REVIEW\n                    : DemandState.SELECT_ACTION}\n                ></demand-builder>\n              `\n            )}\n            ${when(\n              this._showButtons,\n              () => html`\n                ${choose(this._requestState, [\n                  [\n                    RequestState.BUILD,\n                    () => html`\n                      <!-- TODO: Uncomment this once multiple demands are supported -->\n                      <!-- <div id=\"new-dmd-ctr\">\n                  <p><strong>I want to add another demand</strong></p>\n                  <button id=\"new-dmd-btn\">+</button>\n                </div> -->\n                      <button\n                        class=\"nav-btn right-btn\"\n                        ?disabled=${!this._buttonsClickable}\n                        @click=${this.handleReviewClick}\n                      >\n                        Continue to submit Privacy Request\n                      </button>\n                    `,\n                  ],\n                  [\n                    RequestState.REVIEW,\n                    () => html`\n                      <button\n                        class=\"nav-btn ctr-btn\"\n                        ?disabled=${!this._buttonsClickable}\n                        @click=${this.handleSubmitClick}\n                      >\n                        Submit Privacy Request\n                      </button>\n                    `,\n                  ],\n                ])}\n              `\n            )}\n          `\n        )}\n\n        <!-- Sent state -->\n        ${when(\n          this._requestState === RequestState.SENT,\n          () => html`\n            <strong id=\"req-sent-hdr\" class=\"ctr-txt\"\n              >Your privacy request has been sent!</strong\n            >\n            <p class=\"ctr-txt\">You may view the response below.</p>\n            <button\n              id=\"restart-btn\"\n              class=\"ctr-txt ctr-btn\"\n              href=\"\"\n              @click=${this.handleRestartClick}\n            >\n              Submit a new Privacy Request.\n            </button>\n          `\n        )}\n      </div>\n      ${when(\n        this._requestState === RequestState.SENT,\n        () => html`\n          <response-view .response=${this._privacyResponse}></response-view>\n        `\n      )}\n    `;\n  }\n}\n"]}